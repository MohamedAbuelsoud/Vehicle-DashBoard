<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Vehicle Dashboard: Information Technology Institute</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="Picture1.png"/></td>
  <td id="projectalign">
   <div id="projectname">Vehicle Dashboard<span id="projectnumber">&#160;1.0</span>
   </div>
   <div id="projectbrief">Vehicle dashboard to display sensor readings sent from other controller</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Information Technology Institute </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_readme_readme"></a> </p>
<h1><a class="anchor" id="autotoc_md1"></a>
New Capital Branch</h1>
<p><img src="Picture1.png" alt="ITI Logo" title="ITI" class="inline"/> </p>
<h1><a class="anchor" id="autotoc_md2"></a>
Vehicle Dashboard to Display Sensors</h1>
<h1><a class="anchor" id="autotoc_md3"></a>
Data</h1>
<p>Graduation Project</p>
<p>Authors: Mohamed Alaa</p>
<p>Mohamed Beshir</p>
<p>Mahmoud Hamed</p>
<p>Mennatallah Ibrahim</p>
<p>Nadine Ashraf</p>
<p>Khaled Rashad</p>
<div class="fragment"><div class="line">Intake:</div>
<div class="line">43 - Group</div>
</div><!-- fragment --><p> Submission Date: 23 , February, 2023</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Content</h2>
<ul>
<li>Chapter<ul>
<li>1.1 Project Objective</li>
<li>1.2 System Overview</li>
</ul>
</li>
<li>Chapter<ul>
<li>2.1 Introduction</li>
<li>2.2 Software Architecture<ul>
<li>2.2.1 ECU1</li>
<li>2.2.2 ECU2</li>
</ul>
</li>
<li>2.3 Hardware Circuit Diagram</li>
</ul>
</li>
<li>Chapter<ul>
<li>System Implementation</li>
<li>3.1 Introduction</li>
<li>3.2 Implementation<ul>
<li>3.2.1 Fuel level</li>
<li>3.2.2 Temperature</li>
<li>3.2.3 Seatbelt</li>
<li>3.2.4 ABS</li>
<li>3.2.5 Speed</li>
<li>3.2.6 Battery management system</li>
<li>3.2.7 UART Communication Protocol</li>
<li>3.2.8 GUI using QT</li>
</ul>
</li>
</ul>
</li>
<li>Chapter<ul>
<li>4.1 Results and conclusion</li>
</ul>
</li>
<li>References</li>
</ul>
<h3><a class="anchor" id="autotoc_md5"></a>
List of Figures</h3>
<p>Figure 1.1: Mercedes Car Dashboard</p>
<p>Figure 2.1 HW Circuit Diagram</p>
<p>Figure 4.1: Car Dashboard</p>
<p>Figure 4.2: Car Dashboard</p>
<p>Figure 4.3: Car Dashboard</p>
<p>Figure 4.4: Car Dashboard</p>
<h3><a class="anchor" id="autotoc_md6"></a>
List of Tables</h3>
<p>Table 1: Hardware Components</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Chapter 1</h2>
<h3><a class="anchor" id="autotoc_md8"></a>
Introduction</h3>
<p>According the expansion of new technologies and the competing between car makers to provide entertainment to the driver, a new modern system was innovated to replace the old ones to display additional features as shown in Figure 1.1. The dashboard in your car is the control panel of your vehicle. It provides you with all the information you need to know, as well as houses the instruments and controls for operating the vehicle properly.</p>
<p>The dashboard provides many different features to provide you with warnings and information</p>
<h4><a class="anchor" id="autotoc_md9"></a>
that you need to take note of while going down the road. It would not only be difficult but also</h4>
<p>dangerous to operate a car without a dashboard. The car dashboard performs many important functions, which often provide drivers with invaluable help. This is where you can adjust the air conditioning or heating, operate individual lights or monitor the car's performance; it is also the location of the airbags for both driver and passenger. What is more, the lights on the dashboard allow you to quickly identify problems with various components of the vehicle. This Project aims to be portable with different system as it’s compliant to industrial Standards and integrated with free GPL Licensed Software to meet customers’ needs.</p>
<p><img src="f11.png" alt="Mercedes Car Dashboard" title="Mercedes Car Dashboard" class="inline"/></p>
<p>Figure 1. 1 : Mercedes Car Dashboard</p>
<h3><a class="anchor" id="autotoc_md10"></a>
1.1 Project Objective</h3>
<p>Our aim in this project is to Implement Multiple ECUs and interfacing between them through UART. Master ECU: is based on Application SW being deployed on High Performance Board (Raspberry Pi) to display the acquired data by second ECU. Other ECUs: Are used to acquire data from different sensors and sending them to the Master ECU over the UART to display them.</p>
<h3><a class="anchor" id="autotoc_md11"></a>
1.2 System Overview</h3>
<p>Our system can be break downed into two major parts:</p>
<p>Hardware: It was selected for the application purpose.</p>
<p>Component Purpose</p>
<p>RaspberryPi3B+ Works as a host machine and to receive the data from other ECU (Cortex M4 MCU) to be processed by SW to display it on the Graphical LCD.</p>
<p>Graphical LCD Used to display Dashboard widgets on it, which is designed using QT Creator SW.</p>
<p>Cortex M4 MCU Used as a host ECU to acquire the data from sensors and process it to send them through the UART communication protocol.</p>
<p>Current Sensor Used to measure the current passed through the wire to get the get the state of charge of the electric batteries</p>
<p>RC Robot Encoder Used for acquiring speed of Rotated wheels as it’s physically measured.</p>
<p>Logic Analyzer Used as a debugging tool for integration and Testing.</p>
<p>Table 1 : Hardware Components</p>
<p>Software: It’s based on the team efforts to build and integrate SW listed by the HW vendors and also for software developers. We will implement and configure the modules and drivers required to perform our needed applications. The drivers needed are:</p>
<p>RCC, GPIO, ADC, Timer, UART, LCD, <a class="el" href="struct_d_m_a.html">DMA</a>, NVIC &amp; <a class="el" href="struct_s_y_s_t_i_c_k.html">SYSTICK</a>.</p>
<p>RCC: Peripheral used to control the clock of the clock source of the internal peripherals as well as the reset signal.</p>
<p>GPIO: The general-purpose I/O ports is used for driving loads, reading analog and digital signals, controlling external components, generating triggers for external devices as push button indicating the seat belt and ABS.</p>
<p>ADC: To convert the analog signal readings from the potentiometer to digital readings that detects the fuel level, as well as the temperature of the engine.</p>
<p>SYSTICK/NVIC: Used with the Encoder to measure the speed of the vehicle.</p>
<p>UART: It is the communication protocol used to send the data from the RaspberryPi to the Cortex M4 MCU.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Chapter 2</h2>
<h3><a class="anchor" id="autotoc_md13"></a>
Control Design</h3>
<h3><a class="anchor" id="autotoc_md14"></a>
2.1 Introduction</h3>
<p>In order to build and integrate the system properly standard methodologies were followed to increase the portability of it and also to facilitate the debugging and integration processes.</p>
<p>Following both HW and SW design for ECU1 and ECU2 and interfacing between them to get the data and display them. <img src="f21.png" alt="Design" title="Design" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md15"></a>
2.2 Software Architecture</h3>
<h4><a class="anchor" id="autotoc_md16"></a>
2.2.1 ECU1</h4>
<div class="fragment"><div class="line">The software of this ECU is deployed on single Core Microcontroller (Cortex M4). And it</div>
<div class="line">worked one in synchronous single thread starting from initializing the system and pending on</div>
<div class="line">reading the data and sending them as will mentioned in details in the next section.</div>
</div><!-- fragment --><p> <img src="f22.png" alt="flow1" title="flow1" class="inline"/> </p>
<h4><a class="anchor" id="autotoc_md17"></a>
2.2.2 ECU2</h4>
<p>The software of this ECU is deployed on multiple core Board Raspberry pi3 B+ board, and it’s worked as an application that interfaced with Linux Kernal and device driver to interface with HW peripherals.</p>
<p>In order to get the data and display it simultaneously, two threads run parallelly to get the data and update the GUI with the new data based on timer signals every 50 Millis Second. <img src="f3.png" alt="flow2" title="flow2" class="inline"/></p>
<h3><a class="anchor" id="autotoc_md18"></a>
2.3 Hardware Circuit Diagram</h3>
<p>Before implementing the electrical circuit and the control panel, a schematic diagram is drawn and tested with color coded connection to ease the tracing and guarantee that the circuit is performing correctly at its all modes of operation.</p>
<p><img src="f31.png" alt="HW" title="HW" class="inline"/> Figure 2. 1 HW Circuit Diagram</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Chapter 3</h2>
<h3><a class="anchor" id="autotoc_md20"></a>
System Implementation</h3>
<h3><a class="anchor" id="autotoc_md21"></a>
3.1 Introduction</h3>
<p>In his chapter the details and description of the system implementation will be discussed.</p>
<p>Our software application is three layered architecture software. It is classified into MCAL, HAL &amp; SERVICE Layer.</p>
<p>MCAL consists of the software module that directly accesses on-chip MCU peripheral modules and external devices that are mapped to memory, and makes the upper software layer independent of the MCU. In our project we have RCC, GPIO, <a class="el" href="struct_s_y_s_t_i_c_k.html">SYSTICK</a>, NVIC, EXTI, UART, ADC and MSPI in the MCAL layer.</p>
<p>A hardware abstraction layer (HAL) is the layer that allows for more broad communication between software and hardware in a system. In our project we have ADC_conversion, DATA_FRAME, ENCODER, System_Init and Time in the HAL layer.</p>
<p>A Service Layer defines an application's boundary and its set of available operations from the perspective of interfacing client layers. It encapsulates the application's business logic, controlling transactions and coordinating responses in the implementation of its operations. In our project we have Fuel level, Temperature, seatbelt, ABS, Speed and Battery Management System in the SERVICE layer.</p>
<h3><a class="anchor" id="autotoc_md22"></a>
3.2 Implementation</h3>
<h4><a class="anchor" id="autotoc_md23"></a>
3.2.1 Fuel level</h4>
<div class="fragment"><div class="line">In our project we needed to detect the fuel level in the tank to indicate whenever it is falling</div>
<div class="line">below the minimum level assigned which indicate its need to be refilled. We achieved that by</div>
<div class="line">using potentiometer as HW simulator for the fuel level. We used 10 - bit ADC peripheral to</div>
<div class="line">interface with the analog input from the potentiometer which mapped to a digital signal then.</div>
<div class="line">We also used MIL (Malfunction Indicator Light) which is a small, yellow engine-shaped light</div>
<div class="line">indicates that the car&#39;s electronic system has detected a problem that needs to be checked and</div>
<div class="line">here it is activated when fuel level is low</div>
</div><!-- fragment --><h4><a class="anchor" id="autotoc_md24"></a>
3.2.2 Temperature</h4>
<p>We also used potentiometer to simulate the temperature degrees of the car’s engine. We indicated the temperature degrees ranges from 0°C to 250°C where these values were mapped using 10 bit ADC peripheral with resolution of 1024. We also used MIL here where it detects whenever the temperature exceeds a certain degree.</p>
<p>Since in our MCU we have only one ADC peripheral, we used it for both fuel level and temperature detecting by generating two channels from the ADC. We had to use two potentiometers, one for the fuel level and the other for temperature. The ADC toggles between the two channels to gather the data and readings from both. In order to be able to do that we had to use <a class="el" href="struct_d_m_a.html">DMA</a>, to transfer ADC measurements results after conversion to CPU0 DSPR and put them in array to be read periodically.</p>
<p>This array consists of two elements, one for fuel and the other for temperature. Going to the HAL layer, we return the reading of the value of these two elements as per requested and configured. We now need to send these values from the MCU to the RaspberryPi to display these data; therefore we will use UART communication protocol.</p>
<h4><a class="anchor" id="autotoc_md25"></a>
3.2.3 Seatbelt</h4>
<p>We indicated whether the seatbelt is fastened or not using a push button. If the push button is pressed this means that the belt is not fastened and the MIL will be ON giving me an error that I need to fasten the belt, otherwise it means it is fastened.</p>
<h4><a class="anchor" id="autotoc_md26"></a>
3.2.4 ABS</h4>
<p>We indicated whether the ABS is activated or not using a push button. If the push button is pressed this means that the ABS is activated, if not pressed, it means it is activated.</p>
<h4><a class="anchor" id="autotoc_md27"></a>
3.2.5 Speed</h4>
<p>There are some basic topologies that are worthy to be mentioned.</p>
<p>Accuracy: it refers to closeness of the measurements to the true value. The more accurate sensor is preferred but it’s not enough because accuracy comes at the expenses of other criteria.</p>
<p>Noise: the faster sampling of the readings, the more noise appearance on the signal, so algorithms and filters are applied to get pure readings in a short time.</p>
<p>Sampling Rate: is the number of samples produced each second, for GPS it’s once a second, which is fine for navigation, but it is not usable for measuring speed, braking distance and acceleration.</p>
<p>Latency: is the delay between the change in vehicle motion, and the output of sensors. Latency is only important if different parameters are measured at the same time.</p>
<p>Response: it describes how fast sensor output can react to a change in vehicle motion.</p>
<p>According to the previous criteria, different kind of sensors shall be used to get the best of estimation closes to the true value. In this project an Encoder is used to figure the out the speed.</p>
<p>Another kind of sensors shall be used with Encoder to reduce the noise. Get accurate data, GPS and IMU sensor have almost the same output, but proximity sensor is preferred because GPS positioning relies on precise measurements of the distance from the receiver to the satellite, and therefore it suffers from numerous effects - such as atmospheric interference - which delays the signal.</p>
<h4><a class="anchor" id="autotoc_md28"></a>
3.2.6 Battery management system</h4>
<p>Because of nonlinearity behavior of battery state of charge, they are several ways shall be used to detect state of charge e.g., Measured Voltage, Integration of Passed Current, Pressure and heat of battery chemical reaction.</p>
<p>A Simple method (Voltage Level) was used in this project as it’s hard to find mathematical behavior of the test battery and also, it’s was not applicable in our application to charge or discharge the battery for safety wise.</p>
<h4><a class="anchor" id="autotoc_md29"></a>
3.2.7 UART Communication Protocol</h4>
<p>After gathering data from our sensors and our other external devices, we need to send these data through our communication protocol peripheral which is UART in our project. Therefore we needed to activate our drivers to send and receive data from ARM MCU to RaspberryPi. In the service layer we will sent a frame through which our data will be sent.</p>
<p>This frame consists of MSGID(message id), DLC(data length code) which indicates the length of our frame data in bytes, DATA which is the data itself needed to be sent, CRC (cyclic redundancy check) which is XORing for the bytes of the data with the DLC. To send these data we go to the service layer and request to send these data through UART using this frame with this message id and the data length and then receive this data on raspberry pi.</p>
<p>To receive this frame, we first check frame the data length code (DLC) to know the data length since it is dynamic length code then recognize this message id to know which data it belongs to. This data is stored in a variable which then is mapped to its specific variable in the GUI to be represented to the user.</p>
<h4><a class="anchor" id="autotoc_md30"></a>
3.2.8 GUI using QT</h4>
<p>GUI program consists of two threads each thread is in separate module. We will discuss below each module and how it operates:</p>
<ul>
<li>First module is for communication with the other ECU through UART. It's responsible for receiving data and updating reading values. It consists of two functions. First one (UARTvidInit) is a UART initialization function to setup the required configuration. Second one (UARTvidReceive) is a function that receives data from UART and assign it to reading variables. Data received from UART are checked reassembled by this function</li>
<li>Second module is responsible for data visualization. It uses QT frame work. First we designed the GUI structure and appearance and added the required objects then we added a timer as a signal to call a slot regularly. The slot is (WidgetvidUpdateValues) a function that updates data in GUI according to reading variables updated from UART module.</li>
</ul>
<p>Now we will discuss the process of reading in the GUI,</p>
<p>We have 4 variables which are Temperature Value, Battery Value, Speed Value, Fuel Value and Anti-Lock Flag. We will discuss below the usage of each variable:</p>
<p>TempValue: It is a variable that resembles engine temperature. If the temperature is greater than or equal 100 °C, an overheat flag arises. Else, no flag arises.</p>
<p>BatteryValue: It is a variable that resembles battery status. If the battery charge is less than 20%, the battery’s light turns red. Else, battery’s light turns green.</p>
<p>SpeedValue: It is a variable that resembles car’s speed in Km/hr.</p>
<p>AntiLockFlag: Flag resembles antilock brake warning</p>
<p>FuelValue: It is a variable that resembles fuel level. If the fuel level is less than 20%, a fuel low flag arises. Else, no flag arises.</p>
<p>SeatBeltFlag: It is a flag that resembles a seat belt warning if it is not fastened.</p>
<p>Note: The GUI starts at booting automatically when the system is on.</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Chapter 4</h2>
<h2><a class="anchor" id="autotoc_md32"></a>
Results and Conclusion</h2>
<h3><a class="anchor" id="autotoc_md33"></a>
4.1 Results and conclusion</h3>
<p>The “vehicle Dashboard to Display Sensors Data” project is successfully implemented as proposed previously. The data frame is being sent successfully from ARM MCU which is holding the data gathered from the actuators. These data is being received on the RaspberryPi through UART communication protocol and the data is checked through the CRC check. The GUI is acquiring the data and displaying them periodically on the screen to know if any changes have been done.</p>
<p>Next we will represent some results from the GUI:</p>
<p>The picture below Fig. 4 .1 indicates low engine temperature, low speed, half the fuel tank is full and low battery level notification.</p>
<p><img src="f41.png" alt="DashBoard" title="DashBoard" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md34"></a>
Figure 4. 1 : Car Dashboard</h1>
<p>The picture below Fig. 4. 2 indicates high engine temperature and its MIL is activated, high speed, about half the fuel tank is full and charging battery state level notification.</p>
<p><img src="f42.png" alt="DashBoard" title="DashBoard" class="inline"/> Figure 4. 2 : Car Dashboard</p>
<p>The picture below Fig. 4. 3 indicates low engine temperature, low speed, low level fuel tank and its MIL is activated and low charging battery state level notification and its MIL activated in red.</p>
<p><img src="f43.png" alt="DashBoard" title="DashBoard" class="inline"/> Figure 4. 3 : Car Dashboard</p>
<p>The picture below Fig. 4. 4 indicates high engine temperature and its MIL is activated, high speed, low level fuel tank and its MIL is activated and charging battery state level notification and its MIL activated in green.</p>
<p><img src="f44.png" alt="DashBoard" title="DashBoard" class="inline"/> Figure 4. 4 : Car Dashboard</p>
<h1><a class="anchor" id="autotoc_md35"></a>
Figure 4. 4 : Car Dashboard</h1>
<h2><a class="anchor" id="autotoc_md36"></a>
References</h2>
<ol type="1">
<li><a href="https://docs.google.com/spreadsheets/d/1rbeM-F-">https://docs.google.com/spreadsheets/d/1rbeM-F-</a> JKqug1kioDAU9RooQZ36_CAr7/edit#gid=482852532&amp;range=E2:E</li>
<li><a href="https://github.com/alzahraaelsallakh/Infotainment-System-Yocto">https://github.com/alzahraaelsallakh/Infotainment-System-Yocto</a></li>
<li><a href="https://deepbluembedded.com/stm32-timer-encoder-mode-stm32-rotary-encoder-interfacing/">https://deepbluembedded.com/stm32-timer-encoder-mode-stm32-rotary-encoder-interfacing/</a></li>
<li><a href="https://www.badprog.com/electronics-stm32-using-the-adc-peripheral-with-a-potentiometer">https://www.badprog.com/electronics-stm32-using-the-adc-peripheral-with-a-potentiometer</a></li>
<li><a href="https://www.digikey.com/en/maker/projects/getting-started-with-stm32-working-with-adc-and-">https://www.digikey.com/en/maker/projects/getting-started-with-stm32-working-with-adc-and-</a> dma/f5009db3a3ed4370acaf545a3370c30c</li>
<li><a href="https://www.electronicshub.org/how-to-use-adc-in-">https://www.electronicshub.org/how-to-use-adc-in-</a> stm32f103c8t6/#:~:text=So%2C%20the%20range%20of%20ADC,calculated%20using%20the %20following%20formula. </li>
</ol>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
